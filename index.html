<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracker Harian</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(to right, #dbeafe, #faf5ff);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app"></div>

    <script>
        // App state
        let state = {
            dailyBudget: '',
            expenses: [],
            newExpense: '',
            newAmount: '',
            isSetup: false
        };

        // Utility functions
        function formatCurrency(amount) {
            return amount.toLocaleString('id-ID');
        }

        function getCurrentDate() {
            return new Date().toLocaleDateString('id-ID');
        }

        function getCurrentTime() {
            return new Date().toLocaleTimeString('id-ID', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function getTodayExpenses() {
            const today = getCurrentDate();
            return state.expenses.filter(expense => expense.date === today);
        }

        function getTotalSpentToday() {
            return getTodayExpenses().reduce((sum, expense) => sum + expense.amount, 0);
        }

        function getRemainingToday() {
            return state.dailyBudget - getTotalSpentToday();
        }

        function getHoursLeft() {
            const now = new Date();
            const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);
            return Math.max(0, Math.ceil((endOfDay - now) / (1000 * 60 * 60)));
        }

        function getSafeToSpend() {
            const remaining = getRemainingToday();
            const hoursLeft = getHoursLeft();
            return Math.max(0, remaining / Math.max(1, hoursLeft));
        }

        function getStatusColor() {
            const percentage = (getTotalSpentToday() / state.dailyBudget) * 100;
            if (percentage >= 80) return 'text-red-500';
            if (percentage >= 60) return 'text-yellow-500';
            return 'text-green-500';
        }

        function getStatusMessage() {
            const percentage = (getTotalSpentToday() / state.dailyBudget) * 100;
            const remaining = getRemainingToday();
            
            if (percentage >= 100) return 'ðŸš¨ KEBABLASAN! Budget hari ini udah abis!';
            if (percentage >= 90) return 'ðŸš¨ BAHAYA! Budget hari ini hampir habis!';
            if (percentage >= 70) return 'âš ï¸ Hati-hati, udah banyak yang kepake hari ini!';
            if (percentage >= 50) return 'ðŸ‘€ Udah setengah nih budget hari ini...';
            if (remaining > state.dailyBudget * 0.8) return 'âœ… Masih seger banget budget hari ini!';
            return 'ðŸ‘ Oke nih, masih aman buat hari ini!';
        }

        function getProgressBarColor() {
            const percentage = (getTotalSpentToday() / state.dailyBudget) * 100;
            if (percentage >= 80) return 'bg-red-500';
            if (percentage >= 60) return 'bg-yellow-500';
            return 'bg-green-500';
        }

        // Event handlers
        function setupBudget() {
            if (state.dailyBudget > 0) {
                state.isSetup = true;
                render();
            }
        }

        function addExpense() {
            if (state.newExpense && state.newAmount > 0) {
                state.expenses.push({
                    id: Date.now(),
                    name: state.newExpense,
                    amount: parseInt(state.newAmount),
                    date: getCurrentDate(),
                    time: getCurrentTime()
                });
                state.newExpense = '';
                state.newAmount = '';
                render();
            }
        }

        function resetBudget() {
            state = {
                dailyBudget: '',
                expenses: [],
                newExpense: '',
                newAmount: '',
                isSetup: false
            };
            render();
        }

        function clearTodayExpenses() {
            const today = getCurrentDate();
            state.expenses = state.expenses.filter(expense => expense.date !== today);
            render();
        }

        // Render functions
        function renderSetupScreen() {
            return `
                <div class="max-w-md mx-auto mt-8 p-6 bg-white rounded-xl shadow-lg">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 mx-auto mb-4 flex items-center justify-center">
                            <i data-lucide="wallet" class="w-16 h-16 text-blue-500"></i>
                        </div>
                        <h1 class="text-2xl font-bold text-gray-800">Budget Tracker Harian</h1>
                        <p class="text-gray-600">Kontrol pengeluaran setiap hari! ðŸ’¸</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Budget harian kamu berapa?
                            </label>
                            <input
                                type="number"
                                id="budgetInput"
                                placeholder="Misal: 50000"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            />
                        </div>
                        
                        <button
                            id="setupButton"
                            class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors"
                        >
                            Mulai Tracking Hari Ini! ðŸš€
                        </button>
                    </div>
                </div>
            `;
        }

        function renderMainScreen() {
            const totalSpentToday = getTotalSpentToday();
            const remaining = getRemainingToday();
            const percentage = Math.round((totalSpentToday / state.dailyBudget) * 100);
            const hoursLeft = getHoursLeft();
            const safeToSpend = Math.round(getSafeToSpend());
            const todayExpenses = getTodayExpenses();

            return `
                <div class="max-w-md mx-auto mt-8 p-6 bg-white rounded-xl shadow-lg">
                    <div class="text-center mb-6">
                        <h1 class="text-2xl font-bold text-gray-800">Budget Harian</h1>
                        <p class="text-sm text-gray-600">Budget Hari Ini: Rp ${formatCurrency(state.dailyBudget)}</p>
                        <p class="text-xs text-gray-500">${getCurrentDate()}</p>
                    </div>
                    
                    <!-- Status Card -->
                    <div class="gradient-bg p-4 rounded-lg mb-6">
                        <div class="text-center">
                            <div class="text-2xl font-bold ${getStatusColor()}">
                                Rp ${formatCurrency(remaining)}
                            </div>
                            <div class="text-sm text-gray-600">Sisa Budget Hari Ini</div>
                            <div class="text-xs mt-2 font-medium">
                                ${getStatusMessage()}
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between text-xs text-gray-600 mb-1">
                                <span>Terpakai: Rp ${formatCurrency(totalSpentToday)}</span>
                                <span>${percentage}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div 
                                    class="h-2 rounded-full ${getProgressBarColor()}"
                                    style="width: ${Math.min(percentage, 100)}%"
                                ></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-blue-50 p-3 rounded-lg text-center">
                            <div class="w-5 h-5 mx-auto mb-1 flex items-center justify-center">
                                <i data-lucide="clock" class="w-5 h-5 text-blue-500"></i>
                            </div>
                            <div class="text-sm font-medium">${hoursLeft} jam lagi</div>
                            <div class="text-xs text-gray-600">sampai besok</div>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg text-center">
                            <div class="w-5 h-5 mx-auto mb-1 flex items-center justify-center">
                                <i data-lucide="trending-down" class="w-5 h-5 text-green-500"></i>
                            </div>
                            <div class="text-sm font-medium">Rp ${formatCurrency(safeToSpend)}</div>
                            <div class="text-xs text-gray-600">aman per jam</div>
                        </div>
                    </div>
                    
                    <!-- Add Expense -->
                    <div class="bg-gray-50 p-4 rounded-lg mb-6">
                        <h3 class="font-medium mb-3">Tambah Pengeluaran</h3>
                        <div class="space-y-3">
                            <input
                                type="text"
                                id="expenseInput"
                                placeholder="Buat apa? (misal: kopi, makan siang)"
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"
                            />
                            <input
                                type="number"
                                id="amountInput"
                                placeholder="Berapa rupiah?"
                                class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"
                            />
                            <button
                                id="addExpenseButton"
                                class="w-full bg-blue-500 text-white py-2 rounded font-medium hover:bg-blue-600 flex items-center justify-center gap-2"
                            >
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                Tambah
                            </button>
                        </div>
                    </div>
                    
                    <!-- Today's Expenses -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="font-medium">Pengeluaran Hari Ini</h3>
                            ${todayExpenses.length > 0 ? 
                                '<button id="clearTodayButton" class="text-xs text-red-500 hover:text-red-600">Hapus Semua</button>' : 
                                ''
                            }
                        </div>
                        ${todayExpenses.length === 0 ? 
                            '<p class="text-gray-500 text-center py-4">Belum ada pengeluaran hari ini ðŸŽ‰</p>' :
                            `<div class="space-y-2 max-h-48 overflow-y-auto">
                                ${todayExpenses.map(expense => `
                                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                        <div>
                                            <div class="font-medium text-sm">${expense.name}</div>
                                            <div class="text-xs text-gray-500">${expense.time}</div>
                                        </div>
                                        <div class="font-medium text-red-500">
                                            -Rp ${formatCurrency(expense.amount)}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>`
                        }
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="space-y-2">
                        <button
                            id="resetButton"
                            class="w-full bg-gray-500 text-white py-2 rounded font-medium hover:bg-gray-600"
                        >
                            Ganti Budget Harian
                        </button>
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            
            if (!state.isSetup) {
                app.innerHTML = renderSetupScreen();
                
                // Setup event listeners for setup screen
                const budgetInput = document.getElementById('budgetInput');
                const setupButton = document.getElementById('setupButton');
                
                budgetInput.addEventListener('input', (e) => {
                    state.dailyBudget = parseInt(e.target.value) || 0;
                });
                
                setupButton.addEventListener('click', setupBudget);
                
            } else {
                app.innerHTML = renderMainScreen();
                
                // Setup event listeners for main screen
                const expenseInput = document.getElementById('expenseInput');
                const amountInput = document.getElementById('amountInput');
                const addExpenseButton = document.getElementById('addExpenseButton');
                const resetButton = document.getElementById('resetButton');
                const clearTodayButton = document.getElementById('clearTodayButton');
                
                expenseInput.value = state.newExpense;
                amountInput.value = state.newAmount;
                
                expenseInput.addEventListener('input', (e) => {
                    state.newExpense = e.target.value;
                });
                
                amountInput.addEventListener('input', (e) => {
                    state.newAmount = e.target.value;
                });
                
                addExpenseButton.addEventListener('click', addExpense);
                resetButton.addEventListener('click', resetBudget);
                
                if (clearTodayButton) {
                    clearTodayButton.addEventListener('click', clearTodayExpenses);
                }
            }
            
            // Initialize Lucide icons
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        // Initialize the app
        render();
    </script>
</body>
</html>
